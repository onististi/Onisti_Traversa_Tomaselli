<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/HomepageStyle.css">
    <link rel="stylesheet" href="/stylesheets/SingleMovieStyle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">

    <script>
        var actorsData = {{{ json actors.data}}}; //passaggio dei dati al js per la popolazione
        var crewData = {{{json crew.data}}};
    </script>
</head>
<body>
    {{> header}}
<div class="movie-container">
    <div class="movie-header">
        <div class="left-content">
            <h1 class="movie-title" id="movieName">{{movie.name}}</h1>
            <div class="tagline" id="movieTagline">{{movie.tagline}}</div>
            <div class="description-section">
                <div class="header-row">
                    <h2>DESCRIPTION</h2>
                    <span class="duration" id="movieDuration">DURATION: {{movie.minute}} MIN</span>
                </div>
                <div class="description-container">
                    <div class="description-text">
                        <p id="movieDescription">{{movie.description}}</p>
                    </div>
                </div>

                <div class="thread-button-container">
                    <a href = "../chat/:{{movie.id}}" id="threadButton" class="thread-button">Film's Thread</a>
                </div>
            </div>
        </div>
        <div class="overlay" id = "poster" style="background-image: url('{{movie.posterLink}}');"></div>
    </div>

    <div class="content-wrapper">
        <div class="right-content">
            <div class="actors-section">
                <h2>ACTORS</h2>
                <div class="actors-slider" id="actorsSlider">
                    <!-- Slideshow fillato da js se ci sono, se no unknown -->
                </div>
                <div class="slider-nav actors-nav">
                    <div class="prev-arrow-actors">❮</div>
                    <div class="next-arrow-actors">❯</div>
                </div>
            </div>

            <div class="crew-section">
                <h2>CREW</h2>
                <div class="crew-slider" id="crewSlider">
                    <!-- Slideshow fillato da js se ci sono, se no unknown -->
                </div>
                <div class="slider-nav crew-nav">
                    <div class="prev-arrow-crew">❮</div>
                    <div class="next-arrow-crew">❯</div>
                </div>
            </div>

            <div class="movie-info">
                <h2>MOVIE INFO</h2>
                <table class="info-table">
                    <tr>
                        <td>Genre</td>
                        <td id="movieGenre">{{#each movie.genres}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</td>
                    </tr>
                    <tr>
                        <td>Year</td>
                        <td id="movieYear">{{movie.year}}</td>
                    </tr>
                    <tr>
                        <td>Rating</td>
                        <td id="movieRating">{{movie.rating}} /5</td>
                    </tr>
                    <tr>
                        <td>Studios</td>
                        <td id="movieStudios">{{#each movie.studios}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</td>
                    </tr>
                    <tr>
                        <td>Themes</td> <!--  per non fare uscire ultima virgola unless last  -->
                        <td id="movieThemes">{{#each movie.themes}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</td>
                    </tr>
                    <tr>
                        <td>Language</td>
                        <td id="movieLanguages">{{movie.language}}</td>
                    </tr>
                    <tr>
                        <td>Dubbed in</td>
                        <td id="movieDubbed">{{movie.dubbing}}</td>
                    </tr>
                    <tr>
                        <td>Released in</td>
                        <td id="movieReleased">{{movie.releaseInfo}}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="reviews-section">
            <h2>REVIEWS</h2>
            <div class="reviews-container" id="reviewsContainer">
                {{#if reviews.length}}
                    {{#each reviews}}
                        <div class="review-item">
                            <div class="review-header">
                                <span class="review-author">{{this.author}}</span>
                                <div class="review-rating">
                                    {{#times this.rating}}
                                        <span class="star">★</span>
                                    {{/times}}
                                    {{#times (subtract 5 this.rating)}}
                                        <span class="star empty">☆</span>
                                    {{/times}}
                                </div>
                                <span class="review-date">{{formatDate this.date}}</span>
                            </div>
                            <div class="review-content">
                                <p>{{this.content}}</p>
                            </div>
                        </div>
                    {{/each}}
                {{else}}
                    <div class="no-reviews">
                        <p>No reviews yet. Be the first to review this movie!</p>
                    </div>
                {{/if}}
            </div>
            <div class="add-review-section">
                <h3>Add Your Review</h3>
                <form id="reviewForm" action="/movie/{{movie.id}}/review" method="POST">
                    <div class="form-group">
                        <label for="reviewRating">Rating:</label>
                        <div class="rating-input">
                            <input type="radio" id="star5" name="rating" value="5" required>
                            <label for="star5">★</label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4">★</label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3">★</label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2">★</label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1">★</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reviewContent">Your Review:</label>
                        <textarea id="reviewContent" name="content" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="submit-review-btn">Submit Review</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <!--usato per il carosello -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
<script src="/javascripts/movie.js"></script>
</body>
</html>